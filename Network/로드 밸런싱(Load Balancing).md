## 대규모 트래픽에 대처하는 방법
 
> 서버의 성능을 높이기 
1. Scale-up : 기존  서버 한대의 사양을 높이는 방법
2. Scale-out : 서버의 개수를 늘리는 방법 
	-> `로드 밸런싱 (Load Balancing)` : 여러 서버들로 대규모의 네트워크 트래픽을 분산 처리하는 기술

<br>

## 로드 밸런서 (Load Balancer) / 로드 밸런싱 (Load Balancing)이란?
- 로드 밸런서 : 서버의 부하를 분산시키는 하드웨어 또는 소프트웨어
- 로드 밸런싱 : 로드밸런서를 이용해 네트워크 또는 서버에 가해지는 부하를 분산시키는 기술 

<br>

## 로드 밸런서의 역할

-   네트워크 트래픽 또는 클라이언트의 요청을 여러 서버에 적절하게 분배한다. (특정 서버의 부하를 덜어줌)
-   Active한 서버에게만 요청을 전송한다. (서버가 다운되면 리다이렉션 -> 높은 가용성과 신뢰성을 보장)
-   서비스 중단없이 서버를 추가하거나 뺄 수 있게 해준다. (유연성 제공)

<br>

## 로드 밸런서의 종류와 로드 밸런싱의 방법

OSI 7 계층을 기준으로 어떻게 부하를 분산하는지에 따라 종류가 나뉨

-> 부하 분산에는 L4 로드 밸런서와 L7 로드 밸런서가 가장 많이 활용
-  L4부터 포트 정보를 바탕으로 분산하는 것이 가능 -> 한대의 서버에 각각 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영
-  L7 로드 밸런서는 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능


<br>

## L4 로드밸런서

- 네트워크 계층 (IP, IPX)이나 트랜스포트 계층 (TCP, UDP)의 정보를 바탕으로 부하를 분산
- IP 주소나 포트 번호, MAC 주소, 전송 프로토콜 등에 따라 트래픽을 나누고 분산 처리하는 것이 가능

 **[ L4 로드밸런싱 기법]** 
-   **라운드 로빈 (Round Robin)**: 
	- 클라이언트의 요청을 여러 대의 서버에 순차적으로 분배 
	- 추가적인 계산작업이 없이, 들어온 요청을 빠르게 서버에 분산해 전송	
	- 가장 많이 사용되는 로드밸런싱 기법
	- 모든 서버의 스펙이 동일하거나 비슷한 경우에 사용
      
    
-   **가중 라운드 로빈 (Weighted Round Robin)**  
    - 각 서버에 처리량(가중치)를 지정한 후, 가중치가 높은 서버에 클라이언트 요청을 우선적으로 전달
    - 주로 서버의 트래픽 처리 용량이 다를 경우, 즉 특정 서버의 스펙(사양)이 더 좋을 경우 사용
    
-   **IP 해시 (IP Hash)**  
    - 클라이언트의 IP 주소가 어떤 서버로 클라의 요청이 전달될지를 결정하는 방식
      
    
-   **최소 연결 (Least Connection)**  
    - 요청이 들어온 시점에 가장 적게 연결돼있는 서버에 요청을 전송
    - 서버에 분배된 트래픽이 일정하지 않을 경우에 주로 사용
      
    
-   **최소 응답 시간 (Least Response Time)**  
    - 서버의 현재 연결 상태와 응답 시간을 모두 고려하여 가장 적은 연결 수와 가장 짧은 응답 시간을 가지는 서버에 우선적으로 요청을 보내는 방식


<br>

## L7 로드밸런서

1. 애플리케이션 계층 (HTTP, SMTP, FTP)의 정보를 바탕으로도 분산 처리가 가능
-> HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산
2. 특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호할 수 있음
3.  Dos/DDoS와 같은 비정상적인 트래픽을 필터링 가능


 **[ L7 로드밸런싱 기법]** 
-   URL 스위칭 방식 (URL Switching)
    -  특정 하위 URL들은 특정 서버로 처리하는 방식
-   컨텍스트 스위칭 방식 (Context Switching)
    -   클라이언트가 요청한 특정 리소스에 따라 특정 서버로 연결
-   쿠키 지속성 (Persistence with Cookies)
    -   쿠키 정보를 바탕으로 클라이언트가 연결했었던 서버에 계속 할당해 주는 방식

![[네트워크] 로드 밸런서 - 로드 밸런서의 종류와 로드 밸런싱의 방법 - L4 로드 밸런서 vs L7 로드 밸런서](https://blog.kakaocdn.net/dn/b9k0IW/btrnJd9R5lo/O2rYCnkgEuLer5vmkpkz41/img.png)

<br>


## 로드 밸런서 주요 성능 지표

-   초당 연결 수 (Connections per second)
    -   최대 처리 가능한 초당 TCP 세션 개수를 의미한다.
-   동시 연결 수 (Concurrent connections)
    -   동시에 유지할 수 있는 최대 세션 개수를 의미한다.
-   처리 용량 (Throughput)
    -   UDP 프로토콜에 대한 로드 밸런싱 성능 지표
    -   FWLB (Firewall Load Balancing)에서 중요
    -   단위는 bps (bit per second) 또는 pps (packet per second) 사용

<br>

[ Reference ] 
https://chunsubyeong.tistory.com/106
https://steady-coding.tistory.com/535