# 쿠키 (Cookie) & 세션 (Session)

### 쿠키(Cookie)와 세션(Session)을 사용하는 이유

> HTTP 프로토콜의 특징이자 약점을 보완하기 위해 사용

<br/>

### HTTP 프로토콜의 특징

1. **Connectionless 프로토콜 (비연결 지향)**

   > 클라이언트가 서버에 요청(Request)을 했을 때, 그 요청에 맞는 응답(Response)을 보낸 후 **연결을 끊는 처리방식**

- HTTP 1.1 버전에서 connection을 계속 유지하고, 요청에 재활용하는 기능이 추가됨. HTTP Header에 **keep-alive** 옵션을 주어 connection을 재활용하게 함 -> HTTP 1.1 버전에서 default 옵션
- HTTP가 TCP 위에서 구현되었기 때문에 연결 지향적이라고 할 수 있다는 얘기가 있지만, 아직까진 네트워크 관점에서 keep-alive는 옵션으로 두고, 서버 측에서 비연결 지향적인 특성으로 connection 관리에 대한 비용을 줄이는 것이 명확한 장점으로 보기 때문에 비연결 지향으로 봄 (TCP : 연결 지향, UDP : 비연결 지향)

<br/>

2. **Stateless 프로토콜**

> connection을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보는 유지하지 않는 특성

- 클라이언트와 첫 번째 통신에서 데이터를 주고받았다 해도, 두 번째 통신에서 이전 데이터를 유지하지 않음. 하지만, 실제로는 데이터 유지가 필요한 경우가 많음

&rarr; Stateful 경우를 대처하기 위해 쿠키와 세션을 사용

## 쿠키(Cookie)란?

> HTTP의 일종으로 사용자가 어떠한 웹 사이트를 방문할 경우, 그 사이트가 사용하고 있는 서버에서 사용자의 컴퓨터에 저장하는 작은 기록 정보 파일

&rarr; HTTP에서 클라이언트의 상태 정보를 클라이언트의 PC에 저장하였다가 필요시 정보를 참조하거나 재사용할 수 있다.

<br/>

### 쿠키의 특징

1. 이름, 값, 만료일(저장기간), 경로 정보로 구성
2. 클라이언트에 총 300개의 쿠키를 저장할 수 있음
3. 하나의 도메인 당 20개의 쿠키를 가질 수 있음
4. 하나의 쿠키는 4KB(=4096byte)까지 저장 가능

<br/>

### 쿠키의 구성 요소

- 이름 : 각각의 쿠키를 구별하는데 사용되는 이름
- 값 : 쿠키의 이름과 관련된 값
- 유효시간: 쿠키의 유지시간
- 도메인 : 쿠키를 전송할 도메인
- 경로 : 쿠키를 전송할 요청 경로

<br/>

### 쿠키의 동작 순서

① 클라이언트가 페이지를 요청 (사용자가 웹사이트에 접근)<br/>
② 서버는 쿠키를 생성<br/>
③ HTTP 헤더에 쿠키를 포함시켜 응답<br/>
④ 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음<br/>
⑤ 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄<br/>
⑥ 서버에서 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이트하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

<br/>

### 사용 예시

1. 방문 사이트에서 로그인 시, "아이디와 비밀번호를 저장하시겠습니까?"
2. 팝업창을 통해 "오늘 이 창을 다시 보지 않기" 체크
3. 쇼핑몰의 장바구니 기능

<br/>

## 세션(Session)이란?

> 방문자가 서버에 접속해 있는 상태를 하나의 단위로 보고 그것을 세션이라고 함

&rarr; 일정 시간동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지하는 기술

<br/>

**일정시간**이란?
<br/>
&rarr; 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말함

<br/>

### 세션의 특징

1. 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장
2. 웹 서버의 저장되는 쿠키 (= 세션 쿠키)
3. 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제가 되므로, 쿠키보다 비교적 보안이 좋음
4. 저장 데이터에 제한이 없음 (서버 용량이 허용하는 한에서)
5. 각 클라이언트에 고유 Session ID를 부여. Session ID로 클라이언트를 구분해 각 요구에 맞는 서비스를 제공

<br/>

### 세션의 동작 순서

① 클라이언트가 페이지에 요청 <br/>
② 서버는 접근한 클라이언트의 Request-Header 필드인 Cookie를 확인하여, 클라이언트가 해당 Session ID를 보냈는지 확인<br/>
③ Session ID가 존재하지 않는다면 서버는 Session ID를 생성해 클라이언트에게 넘겨줌<br/>
④ 클라이언트는 서버로부터 받은 Session ID를 쿠키에 저장<br/>
⑤ 클라이언트는 서버에 요청시 이 쿠키의 Session ID 값을 서버에 같이 전달<br/>
⑥ 서버는 전달받은 Session ID로 Session에 있는 클라이언트 정보를 가지고 요청을 처리 후 응답

<br/>

### 사용 예시

1. 화면을 이동해도 로그인이 풀리지 않고 로그아웃하기 전까지 유지

<br/>

## 쿠키와 세션의 차이

1. **사용자의 정보가 저장되는 위치**
   <br/>
   &rarr; 쿠키는 서버의 자원을 전혀 사용하지 않지만, 세션은 서버의 자원을 사용
   <br/>
2. **보안**
   <br/>
   &rarr; 쿠키는 클라이언트 로컬에 저장되기 때문에 변질되거나 Request할 때 스니핑 당할 우려가 있어서 보안에 취약<br/>
   &rarr; 세션은 쿠키를 이용해서 Session ID만 저장하고 그것으로 구분하여 서버에서 처리하기 때문에 비교적 보안성이 높음
   <br/>

3. **속도**
   <br/>
   &rarr; 쿠키는 쿠키에 정보가 있기 때문에 서버에 요청 시 속도가 빠름<br/>
   &rarr; 세션은 정보가 서버에 있기 때문에 처리가 요구되어 비교적 속도가 느림
   <br/>

4. **라이프 사이클**
   <br/>
   &rarr; 쿠키는 파일로 저장되기 때문에 브라우저를 종료해도 정보가 유지될 수 있음. 만료 기간을 따로 지정해 쿠키를 삭제할 때까지 유지할 수 있음<br/>
   &rarr; 세션은 만료 기간을 정할 수 있지만, 브라우저가 종료되면 만료 기간에 상관없이 삭제
